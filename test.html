<!DOCTYPE html>
<html>
<head>
<title>Programmazione Musicale</title>
<script src="librerie/jquery-1.11.3.min.js"></script>
<script src="librerie/riffwave.js"></script>
</head>
<body><!-- <body onload="sh_highlightDocument('lang/', '.js');"> -->
<script src="utility/noteMusicali.js"></script>
<script type="text/javascript">//<![CDATA[
$(window).load(function(){
  $("textarea").data("oldValue", function() {
      return this.value;
  }).keyup(function() {
      var $this = $(this);
      if (this.value !== $this.data("oldValue")) {
          var temp = (this.value).split(" ")
          var testCasuale = ["do", "re", "mi", "fa", "la", "si"]
          var booleano = true;
          for (var i = 0; i < temp.length; i++) {
            if (temp[i] != "") {
              lunghezzaAttuale = temp[i].length;
              if (lunghezzaAttuale > 4 || lunghezzaAttuale ==1) {
                booleano = false;

                break;
              };
              if (lunghezzaAttuale == 4) {
                  //devi essere sol + numero
                  if(!isNaN(temp[i].charAt(lunghezzaAttuale-1)) && temp[i].slice(0, -1) == "sol"){
                    //OK!
                    } else{
                    booleano = false;
                    break;
                  }
              };
              if (lunghezzaAttuale == 3) {
                //o sei sol o sei uno degli altri + numero
                if (temp[i] == "sol") {
                  //OK
               } else {
                  if(!isNaN(temp[i].charAt(lunghezzaAttuale-1)) && testCasuale.indexOf(temp[i].slice(0, -1)) > -1){
                    //OK!
                  } else{
                    booleano = false;
                    break;
                  }
                };
              };
              if (lunghezzaAttuale == 2) {
                //devi essere una delle note
                if (testCasuale.indexOf(temp[i]) > -1) {
                  //OK

               }else{
                  booleano = false;

                  break;
                };
              };
            };
          };
          if (booleano) {
              $("#errore").html("");
              $("#ok").html("OK!");
              thereIsABug = false;
          }else{
              $("#errore").html("Errore!");
              $("#ok").html("");
              thereIsABug = true;
          };
          // // console.log("Changed! New value: " + this.value);
          // // console.log((this.value).indexOf("ciao") > -1);
          // if((this.value).indexOf("ciao") > -1){
          //     // console.log("entrato");
          //     $("#theId").val(this.value + "volevosoloaggiungeretesto");
          // };

          // $this.data("oldValue", this.value);
      }
  });
});//]]>

</script>
<script>

var stoSuonando = false;
var thereIsABug = false;

// function play(audio) {
//   if (!audio.paused) { // if playing stop and rewind
//     audio.pause();
//     audio.currentTime = 0;
//   }
//   audio.play();
// }

function riproduci(data, n, m){
  try{
    //variable.constructor === Array
    data[n].play();
    data[n].onended = function() {
      riproduci(data, n-1, m);
    };
  }catch(err){
    stoSuonando = false;
    if (typeof m !== undefined && m > 0) riproduci(data, data.length-1, m-1);
  }
}

Array.prototype.last = function () {
  return this[this.length - 1];
};

function suona(canzoneEsistente){
  console.log(canzoneEsistente);
  if (thereIsABug || stoSuonando) {
    console.log("if in suona" + thereIsABug + stoSuonando);
    return;
  };

  var text = document.getElementById("theId");
  //console.log(text.value);
  var listaDaTextArea = (text.value).split(" ");
  //console.log(listaDaTextArea);
  if (typeof canzoneEsistente !== 'undefined') {
    listaDaTextArea = (canzoneEsistente).split(" ");
  }
 var listaMusicaFinale = [];
 for (var i = 0; i < listaDaTextArea.length; i++) {
   if (listaDaTextArea[i].length > 2 && listaDaTextArea[i].toLowerCase() != "sol") {
    //se ho scelto anche l'ottava o è il sol
    listaMusicaFinale.push(dictionaryParser[(listaDaTextArea[i].slice(0, -1)).toLowerCase() + "_" + listaDaTextArea[i].charAt(listaDaTextArea[i].length-1)])
  } else {
    //uso "ottava base" => 4
    listaMusicaFinale.push(dictionaryParser[listaDaTextArea[i].toLowerCase() + "_4"])
   };
 };
 // console.log(listaMusicaFinale)
 stoSuonando = true;
 riproduci(listaMusicaFinale.reverse(), listaMusicaFinale.length-1, 0);
 console.log(listaMusicaFinale.reverse());
}

</script>
<h2>Some tests</h2>

<textarea id="theId" style="resize: none; width: 600px; height: 300px;" rows="4" cols="50">
</textarea>
<input type="button" value="asddas" id="add" onclick="riproduci(['do_5', 're_5', 'mi_5', 'fa_5', 'sol_5']);" />
<input type="button" value="suona" id="add" onclick="suona()" />

<input type="image" src="img/mario.gif"  width="48" height="48"
onmousedown="suona('mi5 mi5 mi5 do5 mi5 sol5 sol4 do5 sol4 mi4 la4 si4 las4 la4 sol4 mi5 sol5 la5 fa5 sol5 mi5 do5 re5 si4 do5 sol4 mi4 la4 si4 las4 la4 sol4 mi5 sol5 la5 fa5 sol5 mi5 do5 re5 si4 sol5 las5 la5 re5 mi5 las4 la4 do5 la4 do5 re5 sol5 las5 la5 re5 mi5 do6 do6 do6 sol5 las5 la5 re5 mi5 las4 la4 do5 la4 do5 re5 si5 re5 do5 do5 do5 do5 do5 re5 mi5 do5 la4 sol4 do5 do5 do5 do5 re5 mi5 do5 do5 do5 do5 re5 mi5 do5 la4 sol4 mi5 mi5 mi5 do5 sol5 sol4 mi5 do5');">


<p id="ok"></p>
<p id="errore"></p>
</body>
</html>

<!--
do · re · mi · fa · sol · la · si
C     D    E    F     G    A     B
-->
