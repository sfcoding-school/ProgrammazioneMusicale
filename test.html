<!DOCTYPE html>
<html>
<head>
<title>Programmazione Musicale</title>
<script src="librerie/jquery-1.11.3.min.js"></script>
<script src="librerie/sh_main.min.js"></script> <!-- bisogna capire a cosa servano -->
<script src="librerie/sh_javascript.min.js"></script> <!-- bisogna capire a cosa servano -->
<script src="librerie/riffwave.js"></script>
</head>
<body onload="sh_highlightDocument('lang/', '.js');">
<script src="utility/noteMusicali.js"></script>
<script type='text/javascript'>//<![CDATA[
$(window).load(function(){
  $("textarea").data("oldValue", function() {
      return this.value;
  }).keyup(function() {
      var $this = $(this);
      if (this.value !== $this.data("oldValue")) {
          var temp = (this.value).split(" ")
          var testCasuale = ["do", "re", "mi", "fa", "la", "si"]
          var booleano = true;
          for (var i = 0; i < temp.length; i++) {
            if (temp[i] != "") {
              lunghezzaAttuale = temp[i].length;
              if (lunghezzaAttuale > 4 || lunghezzaAttuale ==1) {
                booleano = false;
                
                break;
              };
              if (lunghezzaAttuale == 4) {
                  //devi essere sol + numero
                  if(!isNaN(temp[i].charAt(lunghezzaAttuale-1)) && temp[i].slice(0, -1) == "sol"){
                    //OK!
                                      } else{
                    booleano = false;
                    
                    break;
                  }
              };
              if (lunghezzaAttuale == 3) {
                //o sei sol o sei uno degli altri + numero
                if (temp[i] == "sol") {
                  //OK

               } else {
                  if(!isNaN(temp[i].charAt(lunghezzaAttuale-1)) && testCasuale.indexOf(temp[i].slice(0, -1)) > -1){
                    //OK!
                                      } else{
                    booleano = false;
                    
                    break;
                  }
                };
              };
              if (lunghezzaAttuale == 2) {
                //devi essere una delle note
                if (testCasuale.indexOf(temp[i]) > -1) {
                  //OK

               }else{
                  booleano = false;
                  
                  break;
                };
              };
            };
          };
          if (booleano) {
              $("#errore").html("");
              $("#ok").html("OK!");
              thereIsABug = false;
          }else{
              $("#errore").html("Errore!");
              $("#ok").html("");
              thereIsABug = true;
          };
          // // console.log("Changed! New value: " + this.value);
          // // console.log((this.value).indexOf("ciao") > -1);
          // if((this.value).indexOf("ciao") > -1){
          //     // console.log("entrato");
          //     $("#theId").val(this.value + "volevosoloaggiungeretesto");
          // };

          // $this.data("oldValue", this.value);
      }
  });
});//]]> 

</script>
<script>

var stoSuonando = false;
var thereIsABug = false;

function play(audio) {
  if (!audio.paused) { // if playing stop and rewind
    audio.pause();
    audio.currentTime = 0;
  }
  audio.play();
}

function test2(audio){
  audio.play();
}

function test(data){
  try{
    data.last().play();
    data.last().onended = function() {
      data.pop();
      test(data);
    };
  }catch(err){
    stoSuonando = false;
  }
}

Array.prototype.last = function () {
  return this[this.length - 1];
};

function showtext(){
  if (thereIsABug || stoSuonando) {
    console.log("if in showtext" + thereIsABug + stoSuonando);
    return;};
 var text = document.getElementById("theId");
 console.log(text.value);
 var listaDaTextArea = (text.value).split(" ");
 console.log(listaDaTextArea);
 
 var listaMusicaFinale = [];
 for (var i = 0; i < listaDaTextArea.length; i++) {
   if (listaDaTextArea[i].length > 2 && listaDaTextArea[i].toLowerCase() != "sol") {
    //se ho scelto anche l'ottava o è il sol
    listaMusicaFinale.push(dictionaryParser[(listaDaTextArea[i].slice(0, -1)).toLowerCase() + "_" + listaDaTextArea[i].charAt(listaDaTextArea[i].length-1)])
  } else {
    //uso "ottava base" => 4
    listaMusicaFinale.push(dictionaryParser[listaDaTextArea[i].toLowerCase() + "_4"])
   };
 };
 // console.log(listaMusicaFinale)
 stoSuonando = true;
 test(listaMusicaFinale.reverse())
}

</script>
<!-- <script type="text/javascript">
$(document).ready(function() {
    $("#btnSubmit").click(function(){

        alert("ciao");
    }); 
});
</script> -->
<h2>Some tests</h2>

<textarea id="theId" style="resize: none; width: 600px; height: 300px;" rows="4" cols="50">
</textarea>
<input type="button" value="TestTextArea" id="add" onclick="showtext()" />

<input type="image" src="mario.gif"  width="48" height="48" onmousedown="test([E_5, E_5, E_5, C_5, E_5, G_5, pausa, G_4, pausa, C_5, pausa, G_4, pausa,  E_4, pausa, A_4, B_4, A_s_4, A_4, pausa, G_4, E_5, G_5, A_5, F_5, G_5, E_5, C_5, D_5, B_4, C_5, pausa, G_4, pausa, E_4, A_4, B_4, A_s_4, A_4, pausa, G_4, E_5, G_5, A_5, F_5, G_5, E_5, C_5, D_5, B_4, pausa, G_5, Fa_s_5, Fa_5, D_5, E_5, A_s_4, A_4, C_5, pausa, A_4, C_5, D_5,
G_5, Fa_s_5, Fa_5, D_5, E_5, C_6, C_6, C_6, pausa, G_5, Fa_s_5, 
Fa_5, D_5, E_5, A_s_4, A_4, C_5, pausa, A_4, C_5, D_5, pausa, 
D_b_5, D_5, pausa, C_5, pausa, C_5, C_5, C_5, C_5, D_5, E_5, C_5,
A_4, G_4, pausa, C_5, C_5, C_5, C_5, D_5, E_5, pausa, C_5, C_5, C_5,
C_5, D_5, E_5, C_5, A_4, G_4, E_5, E_5, E_5, C_5, G_5, pausa,
G_4, E_5, C_5].reverse());">

<p id="ok"></p>
<p id="errore"></p>
</body>
</html>

<!-- 
do · re · mi · fa · sol · la · si
C     D    E    F     G    A     B 
-->